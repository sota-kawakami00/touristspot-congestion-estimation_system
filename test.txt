観光地混雑推定システム - 予測センサー値と閾値設定
===============================================

## センサー仕様と測定範囲

### 1. PIRモーションセンサー (人感センサー)
- 検出範囲：115度、最大8m
- 出力：デジタル (True/False)
- 反応時間：約2秒安定化
- 使用目的：人の動きを検出

### 2. HC-SR04超音波距離センサー
- 測定範囲：2cm～450cm
- 精度：±3mm
- 動作周波数：40kHz
- 使用目的：人との距離測定、混雑密度推定

### 3. AM2302温湿度センサー
- 温度範囲：-40°C～80°C (±0.5°C精度)
- 湿度範囲：0%～99.9% (±3%精度)
- 使用目的：環境監視、快適性評価

## 予測センサー値

### 距離センサー予測値 (cm)
- 閑散時：150-400cm (人が遠い、または少ない)
- 通常時：50-150cm (適度な人数)
- 混雑時：5-50cm (人が非常に近い、密集状態)
- エラー値：-1 (測定範囲外)

### 温度センサー予測値 (°C)
- 夏季(観光地屋外)：25-35°C
- 春秋季：15-25°C
- 冬季：0-15°C
- 屋内施設：20-26°C (空調環境)

### 湿度センサー予測値 (%)
- 晴天時：40-60%
- 雨天時：70-90%
- 乾燥時：20-40%
- 標準的環境：50-70%

### モーションセンサー予測値
- 検出頻度(10秒間):
  - 閑散時：0-2回
  - 通常時：3-7回
  - 混雑時：8-10回

## 混雑度判定閾値設定

### 閾値パラメータ
```python
# 距離ベース混雑判定
DISTANCE_CROWDED_THRESHOLD = 50      # 50cm以下で混雑
DISTANCE_NORMAL_THRESHOLD = 150     # 150cm以下で通常
DISTANCE_SPARSE_THRESHOLD = 150     # 150cm超で閑散

# モーション頻度判定 (10秒間の検出回数)
MOTION_CROWDED_THRESHOLD = 8        # 8回以上で混雑
MOTION_NORMAL_THRESHOLD = 3         # 3-7回で通常
MOTION_SPARSE_THRESHOLD = 3         # 3回未満で閑散

# 複合判定重み
DISTANCE_WEIGHT = 0.7               # 距離の重要度
MOTION_WEIGHT = 0.3                 # モーションの重要度
```

## 混雑レベル定義

### 閑散時 (Sparse)
**特徴:**
- 距離センサー：150cm以上
- モーション検出：10秒間で0-2回
- 人の密度：低い
- 移動：ゆっくり、自由な移動

**予測値例:**
- 距離：200-400cm
- モーション頻度：1回/10秒
- 温度：環境温度±1°C
- 湿度：標準値

### 通常時 (Normal)
**特徴:**
- 距離センサー：50-150cm
- モーション検出：10秒間で3-7回
- 人の密度：適度
- 移動：普通の歩行速度

**予測値例:**
- 距離：80-120cm
- モーション頻度：5回/10秒
- 温度：環境温度+1-2°C (人の体温影響)
- 湿度：標準値+5-10%

### 混雑時 (Crowded)
**特徴:**
- 距離センサー：50cm以下
- モーション検出：10秒間で8回以上
- 人の密度：高い
- 移動：遅い、制限された移動

**予測値例:**
- 距離：10-40cm
- モーション頻度：9-10回/10秒
- 温度：環境温度+2-5°C (多数の人体熱)
- 湿度：標準値+10-20% (呼吸、発汗)

## 実際の測定例シミュレーション

### シナリオ1: 朝の公園 (閑散時)
```
時刻: 07:00
距離: 280cm
モーション: False → True → False (1回/10秒)
温度: 18.5°C
湿度: 55%
判定: 閑散
```

### シナリオ2: 昼間の観光地 (通常時)
```
時刻: 14:00
距離: 95cm
モーション: True → False → True → True → False (5回/10秒)
温度: 26.8°C
湿度: 62%
判定: 通常
```

### シナリオ3: イベント時 (混雑時)
```
時刻: 19:00
距離: 25cm
モーション: True → True → True → False → True (9回/10秒)
温度: 29.2°C
湿度: 73%
判定: 混雑
```

## アラート閾値

### 危険レベル
- 距離：10cm以下 (過度の密集)
- モーション：10回/10秒 (異常な動き)
- 温度：35°C以上 (熱中症リスク)
- 湿度：90%以上 (不快指数危険)

### 警告レベル
- 距離：20cm以下 (高密度)
- モーション：8回以上/10秒 (混雑)
- 温度：32°C以上 (注意)
- 湿度：80%以上 (不快)

## 測定エラー対応

### 無効データ
- 距離：-1 (範囲外)
- 温度：None (読み取りエラー)
- 湿度：None (読み取りエラー)
- モーション：継続的なFalse (センサー故障)

### データ補正
- 3回連続エラー時：前回有効値を使用
- 5回連続エラー時：システムアラート
- 異常値検出：統計的外れ値除去

## 混雑推定アルゴリズム

### 総合スコア計算
```python
def calculate_congestion_score(distance, motion_count, temperature, humidity):
    # 距離スコア (0-100)
    if distance <= 50:
        distance_score = 100 - (distance * 2)  # 0-50cm → 100-0点
    else:
        distance_score = max(0, 100 - distance)  # 51cm以上 → 低スコア

    # モーションスコア (0-100)
    motion_score = min(100, motion_count * 10)  # 10回で満点

    # 総合スコア
    total_score = (distance_score * 0.7) + (motion_score * 0.3)

    # 判定
    if total_score >= 80:
        return "混雑"
    elif total_score >= 40:
        return "通常"
    else:
        return "閑散"
```

注意：この予測値は理論値であり、実際の運用では現地での校正が必要です。